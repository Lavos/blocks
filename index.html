<!doctype html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>blocks</title>

	<script type="text/javascript" src="curl.js"></script>
</head>

<body>
	<div id="master">
		<div id="list"></div>

		<script type="text/html" id="list_master_template">
			<ul class="target"></ul>

			<p><button data-action="add">Add New Item</button><button data-action="serialize">Serialize</button></p>
		</script>

		<script type="text/html" id="list_entry_template">
			<p>[!= dt.title !]</p>
			<p><input type="text" placeholder="set new title"/><button data-action="update">update</button><p>
		</script>
	</div><!-- /#master -->

	<script type="text/javascript">
		curl(['blocks', 'doubleunderscore']).then(function(Blocks, __){
			var Model = Blocks.Model.inherits(function(){}, { test: 12345 });
			var DifferentModel = Model.inherits(function(){}, { test: 67890 });
			var AltModel = DifferentModel.inherits(function(){}, { test: 'xyz' });

			var m = new Model();
			var d = new DifferentModel();
			var a = new AltModel();

			console.log('m', m);
			console.log('d', d);
			console.log('a', a);


			var Collection = Blocks.Collection.inherits(function(){}, { test: 12345 });

			var c = new Collection();
			c.on('debug', function(){ console.dir(arguments); });

			c.push('abc');

			console.log('c', c);


			var Data = Blocks.Model.inherits(function(){}, {
				data: { test: 12345 }
			});

			var View = Blocks.View.inherits(function(model){
				this.model = model;
				this.model.on('change', this.render, this);
			}, {
				render: function(){
					console.log('render', this.model);
				}
			});

			var d = new Data();
			c.push(d);	
			var v = new View(d);
			
			d.set('test', 'bananas');

			console.log('v', v);
		});
	</script>

	<script type="text/javascriptx">
		curl(['jquery', 'blocks', 'doubleunderscore']).then(function($, Blocks, __){
			// debugger;
			var $list = $('#list');

			var Item = Blocks.Model.inherits(function(){}, {
				data: { title: 'Default Title' }
			});

			var List = Blocks.Model.inherits(function(){}, {
				titles: []
			});

			var TitleList = Blocks.Collection.inherits(function(){}, { model_constructor: List });

			console.log(TitleList);			

			var krislist = new TitleList();
			krislist.on('debug', function(){ console.dir(arguments); });

			var ListMaster = Blocks.View.inherits(function(){}, {
				element_classes: 'list_master',
				template_string: document.getElementById('list_master_template').innerHTML,
				events: [
					{ event_name: 'click', selector: '[data-action="add"]', function_name: 'add_item' },
					{ event_name: 'click', selector: '[data-action="serialize"]', function_name: 'echo' }
				],
				render: function render () {
					console.log('list master render');
					this.element.innerHTML = this.comp_template();
					this.$target = this.$element.find('ul.target');
					console.log(this);
				},
				add_item: function add_item () {
					console.log('add item!');
					var view = new ListEntry({ model: new Item() });
					view.render(view.model.data);
					krislist.push(view.model);
					this.$target.append(view.element);
					console.log('KrisList', krislist);
				},
				echo: function echo () {
					console.log('echo!');
					console.log(krislist.data.titles);
				}
			});

			var mylistmaster = new ListMaster();

			mylistmaster.render();
			$list.append(mylistmaster.element);

	
			var ListEntry = Blocks.View.inherits(function(params){
				var self = this;

				this.model = params.model;
				this.model.on('change', function(){ self.render(this.data) });
			}, {
				tag_name: 'li',
				element_classes: 'list_entry',
				template_string: document.getElementById('list_entry_template').innerHTML,
				events: [
					{ event_name: 'click', selector: '[data-action="update"]', function_name: 'change' }
				],
				render: function render (data) {
					console.log('render!');
					this.element.innerHTML = this.comp_template(data);
					this.$input = this.$element.find('input');
				},
				change:function change (element) {
					this.model.set('title', this.$input.val());
				}
			});
		});
	</script>
</body>
</html>

